#!/usr/bin/env python
#
# Copyright 2016 Google Inc.
#
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

from __future__ import print_function

import collections
import json
import os
import subprocess
import sys

# Finds all public sources in include directories then write them to skia.h.

# Also write skia.h.deps, which Ninja uses to track dependencies. It's the
# very same mechanism Ninja uses to know which .h files affect which .cpp files.

skia_h = sys.argv[3]

with open(skia_h, 'w') as f:
    f.write('// skia.h generated by GN.\n')
    f.write('#ifndef skia_h_DEFINED\n')
    f.write('#define skia_h_DEFINED\n')
    f.write('#include "client_utils/android/BRDAllocator.h"\n')
    f.write('#include "client_utils/android/BitmapRegionDecoder.h"\n')
    f.write('#include "client_utils/android/FrontBufferedStream.h"\n')
    f.write('#include "include/core/SkAlphaType.h"\n')
    f.write('#include "include/core/SkAnnotation.h"\n')
    f.write('#include "include/core/SkArc.h"\n')
    f.write('#include "include/core/SkBBHFactory.h"\n')
    f.write('#include "include/core/SkBitmap.h"\n')
    f.write('#include "include/core/SkBlendMode.h"\n')
    f.write('#include "include/core/SkBlender.h"\n')
    f.write('#include "include/core/SkBlurTypes.h"\n')
    f.write('#include "include/core/SkCanvas.h"\n')
    f.write('#include "include/core/SkCanvasVirtualEnforcer.h"\n')
    f.write('#include "include/core/SkCapabilities.h"\n')
    f.write('#include "include/core/SkClipOp.h"\n')
    f.write('#include "include/core/SkColor.h"\n')
    f.write('#include "include/core/SkColorFilter.h"\n')
    f.write('#include "include/core/SkColorPriv.h"\n')
    f.write('#include "include/core/SkColorSpace.h"\n')
    f.write('#include "include/core/SkColorTable.h"\n')
    f.write('#include "include/core/SkColorType.h"\n')
    f.write('#include "include/core/SkContourMeasure.h"\n')
    f.write('#include "include/core/SkCoverageMode.h"\n')
    f.write('#include "include/core/SkCubicMap.h"\n')
    f.write('#include "include/core/SkData.h"\n')
    f.write('#include "include/core/SkDataTable.h"\n')
    f.write('#include "include/core/SkDocument.h"\n')
    f.write('#include "include/core/SkDrawable.h"\n')
    f.write('#include "include/core/SkExecutor.h"\n')
    f.write('#include "include/core/SkFlattenable.h"\n')
    f.write('#include "include/core/SkFont.h"\n')
    f.write('#include "include/core/SkFontArguments.h"\n')
    f.write('#include "include/core/SkFontMetrics.h"\n')
    f.write('#include "include/core/SkFontMgr.h"\n')
    f.write('#include "include/core/SkFontParameters.h"\n')
    f.write('#include "include/core/SkFontScanner.h"\n')
    f.write('#include "include/core/SkFontStyle.h"\n')
    f.write('#include "include/core/SkFontTypes.h"\n')
    f.write('#include "include/core/SkFourByteTag.h"\n')
    f.write('#include "include/core/SkGraphics.h"\n')
    f.write('#include "include/core/SkImage.h"\n')
    f.write('#include "include/core/SkImageFilter.h"\n')
    f.write('#include "include/core/SkImageGenerator.h"\n')
    f.write('#include "include/core/SkImageInfo.h"\n')
    f.write('#include "include/core/SkM44.h"\n')
    f.write('#include "include/core/SkMallocPixelRef.h"\n')
    f.write('#include "include/core/SkMaskFilter.h"\n')
    f.write('#include "include/core/SkMatrix.h"\n')
    f.write('#include "include/core/SkMesh.h"\n')
    f.write('#include "include/core/SkMilestone.h"\n')
    f.write('#include "include/core/SkOpenTypeSVGDecoder.h"\n')
    f.write('#include "include/core/SkOverdrawCanvas.h"\n')
    f.write('#include "include/core/SkPaint.h"\n')
    f.write('#include "include/core/SkPath.h"\n')
    f.write('#include "include/core/SkPathBuilder.h"\n')
    f.write('#include "include/core/SkPathEffect.h"\n')
    f.write('#include "include/core/SkPathMeasure.h"\n')
    f.write('#include "include/core/SkPathTypes.h"\n')
    f.write('#include "include/core/SkPathUtils.h"\n')
    f.write('#include "include/core/SkPicture.h"\n')
    f.write('#include "include/core/SkPictureRecorder.h"\n')
    f.write('#include "include/core/SkPixelRef.h"\n')
    f.write('#include "include/core/SkPixmap.h"\n')
    f.write('#include "include/core/SkPoint.h"\n')
    f.write('#include "include/core/SkPoint3.h"\n')
    f.write('#include "include/core/SkRRect.h"\n')
    f.write('#include "include/core/SkRSXform.h"\n')
    f.write('#include "include/core/SkRasterHandleAllocator.h"\n')
    f.write('#include "include/core/SkRect.h"\n')
    f.write('#include "include/core/SkRefCnt.h"\n')
    f.write('#include "include/core/SkRegion.h"\n')
    f.write('#include "include/core/SkScalar.h"\n')
    f.write('#include "include/core/SkSerialProcs.h"\n')
    f.write('#include "include/core/SkShader.h"\n')
    f.write('#include "include/core/SkSize.h"\n')
    f.write('#include "include/core/SkSpan.h"\n')
    f.write('#include "include/core/SkStream.h"\n')
    f.write('#include "include/core/SkString.h"\n')
    f.write('#include "include/core/SkStrokeRec.h"\n')
    f.write('#include "include/core/SkSurface.h"\n')
    f.write('#include "include/core/SkSurfaceProps.h"\n')
    f.write('#include "include/core/SkSwizzle.h"\n')
    f.write('#include "include/core/SkTextBlob.h"\n')
    f.write('#include "include/core/SkTextureCompressionType.h"\n')
    f.write('#include "include/core/SkTiledImageUtils.h"\n')
    f.write('#include "include/core/SkTraceMemoryDump.h"\n')
    f.write('#include "include/core/SkTypeface.h"\n')
    f.write('#include "include/core/SkTypes.h"\n')
    f.write('#include "include/core/SkUnPreMultiply.h"\n')
    f.write('#include "include/core/SkVertices.h"\n')
    f.write('#include "include/core/SkYUVAInfo.h"\n')
    f.write('#include "include/core/SkYUVAPixmaps.h"\n')
    f.write('#include "include/docs/SkPDFDocument.h"\n')
    f.write('#include "include/effects/Sk1DPathEffect.h"\n')
    f.write('#include "include/effects/Sk2DPathEffect.h"\n')
    f.write('#include "include/effects/SkBlenders.h"\n')
    f.write('#include "include/effects/SkBlurMaskFilter.h"\n')
    f.write('#include "include/effects/SkColorMatrix.h"\n')
    f.write('#include "include/effects/SkColorMatrixFilter.h"\n')
    f.write('#include "include/effects/SkCornerPathEffect.h"\n')
    f.write('#include "include/effects/SkDashPathEffect.h"\n')
    f.write('#include "include/effects/SkDiscretePathEffect.h"\n')
    f.write('#include "include/effects/SkGradientShader.h"\n')
    f.write('#include "include/effects/SkHighContrastFilter.h"\n')
    f.write('#include "include/effects/SkImageFilters.h"\n')
    f.write('#include "include/effects/SkLumaColorFilter.h"\n')
    f.write('#include "include/effects/SkOverdrawColorFilter.h"\n')
    f.write('#include "include/effects/SkPerlinNoiseShader.h"\n')
    f.write('#include "include/effects/SkRuntimeEffect.h"\n')
    f.write('#include "include/effects/SkShaderMaskFilter.h"\n')
    f.write('#include "include/effects/SkTableMaskFilter.h"\n')
    f.write('#include "include/encode/SkJpegEncoder.h"\n')
    f.write('#include "include/gpu/ganesh/GrBackendSemaphore.h"\n')
    f.write('#include "include/gpu/ganesh/GrBackendSurface.h"\n')
    f.write('#include "include/gpu/ganesh/GrContextOptions.h"\n')
    f.write('#include "include/gpu/ganesh/GrContextThreadSafeProxy.h"\n')
    f.write('#include "include/gpu/ganesh/GrDirectContext.h"\n')
    f.write('#include "include/gpu/ganesh/GrDriverBugWorkarounds.h"\n')
    f.write('#include "include/gpu/ganesh/GrRecordingContext.h"\n')
    f.write('#include "include/gpu/ganesh/GrTypes.h"\n')
    f.write('#include "include/gpu/ganesh/GrYUVABackendTextures.h"\n')
    f.write('#include "include/gpu/ganesh/gl/GrGLAssembleInterface.h"\n')
    f.write('#include "include/gpu/ganesh/gl/GrGLConfig.h"\n')
    f.write('#include "include/gpu/ganesh/gl/GrGLExtensions.h"\n')
    f.write('#include "include/gpu/ganesh/gl/GrGLFunctions.h"\n')
    f.write('#include "include/gpu/ganesh/gl/GrGLInterface.h"\n')
    f.write('#include "include/gpu/ganesh/gl/GrGLTypes.h"\n')
    f.write('#include "include/gpu/ganesh/mock/GrMockTypes.h"\n')
    f.write('#include "include/pathops/SkPathOps.h"\n')
    f.write('#include "include/utils/SkCamera.h"\n')
    f.write('#include "include/utils/SkCanvasStateUtils.h"\n')
    f.write('#include "include/utils/SkCustomTypeface.h"\n')
    f.write('#include "include/utils/SkEventTracer.h"\n')
    f.write('#include "include/utils/SkNWayCanvas.h"\n')
    f.write('#include "include/utils/SkNoDrawCanvas.h"\n')
    f.write('#include "include/utils/SkNullCanvas.h"\n')
    f.write('#include "include/utils/SkOrderedFontMgr.h"\n')
    f.write('#include "include/utils/SkPaintFilterCanvas.h"\n')
    f.write('#include "include/utils/SkParse.h"\n')
    f.write('#include "include/utils/SkParsePath.h"\n')
    f.write('#include "include/utils/SkShadowUtils.h"\n')
    f.write('#include "include/utils/mac/SkCGUtils.h"\n')
    f.write('#include "modules/skottie/include/ExternalLayer.h"\n')
    f.write('#include "modules/skottie/include/Skottie.h"\n')
    f.write('#include "modules/skottie/include/SkottieProperty.h"\n')
    f.write('#include "modules/skshaper/include/SkShaper.h"\n')
    f.write('#include "modules/svg/include/SkSVGAttribute.h"\n')
    f.write('#include "modules/svg/include/SkSVGAttributeParser.h"\n')
    f.write('#include "modules/svg/include/SkSVGCircle.h"\n')
    f.write('#include "modules/svg/include/SkSVGClipPath.h"\n')
    f.write('#include "modules/svg/include/SkSVGContainer.h"\n')
    f.write('#include "modules/svg/include/SkSVGDOM.h"\n')
    f.write('#include "modules/svg/include/SkSVGDefs.h"\n')
    f.write('#include "modules/svg/include/SkSVGEllipse.h"\n')
    f.write('#include "modules/svg/include/SkSVGFe.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeBlend.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeColorMatrix.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeComposite.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeDisplacementMap.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeFlood.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeGaussianBlur.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeImage.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeLightSource.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeLighting.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeMorphology.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeOffset.h"\n')
    f.write('#include "modules/svg/include/SkSVGFeTurbulence.h"\n')
    f.write('#include "modules/svg/include/SkSVGFilter.h"\n')
    f.write('#include "modules/svg/include/SkSVGFilterContext.h"\n')
    f.write('#include "modules/svg/include/SkSVGG.h"\n')
    f.write('#include "modules/svg/include/SkSVGGradient.h"\n')
    f.write('#include "modules/svg/include/SkSVGHiddenContainer.h"\n')
    f.write('#include "modules/svg/include/SkSVGIDMapper.h"\n')
    f.write('#include "modules/svg/include/SkSVGImage.h"\n')
    f.write('#include "modules/svg/include/SkSVGLine.h"\n')
    f.write('#include "modules/svg/include/SkSVGLinearGradient.h"\n')
    f.write('#include "modules/svg/include/SkSVGMask.h"\n')
    f.write('#include "modules/svg/include/SkSVGNode.h"\n')
    f.write('#include "modules/svg/include/SkSVGPath.h"\n')
    f.write('#include "modules/svg/include/SkSVGPattern.h"\n')
    f.write('#include "modules/svg/include/SkSVGPoly.h"\n')
    f.write('#include "modules/svg/include/SkSVGRadialGradient.h"\n')
    f.write('#include "modules/svg/include/SkSVGRect.h"\n')
    f.write('#include "modules/svg/include/SkSVGRenderContext.h"\n')
    f.write('#include "modules/svg/include/SkSVGSVG.h"\n')
    f.write('#include "modules/svg/include/SkSVGShape.h"\n')
    f.write('#include "modules/svg/include/SkSVGStop.h"\n')
    f.write('#include "modules/svg/include/SkSVGText.h"\n')
    f.write('#include "modules/svg/include/SkSVGTransformableNode.h"\n')
    f.write('#include "modules/svg/include/SkSVGTypes.h"\n')
    f.write('#include "modules/svg/include/SkSVGUse.h"\n')
    f.write('#include "modules/svg/include/SkSVGValue.h"\n')
    f.write('#endif//skia_h_DEFINED\n')

# Temporary: during development this file wrote skia.h.d, not skia.h.deps,
# and I think we have some bad versions of those files laying around.
if os.path.exists(skia_h + '.d'):
    os.remove(skia_h + '.d')
